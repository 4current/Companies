---
title: "Amazon Analysis"
output:
  html_notebook:
    df_print: kable
---


From https://www.wsj.com/market-data/quotes/AMZN/financials/annual/income-statement

## Analyze revenue growth - Top Line
```{r, results = 'asis' }
library(rvest)
library(data.table)
url <- 'https://www.wsj.com/market-data/quotes/AMZN/financials/annual/income-statement'
wsj_tbl <- read_html(url) %>%
  html_element(xpath = '//table[@class="cr_dataTable"]') %>%
  html_table()

wsj_df <- as.data.frame(wsj_tbl[wsj_tbl[,1]!="",1:6])
year_vals <- colnames(wsj_df)[2:6]
data_labels <- wsj_df[,1]
data_values <- wsj_df[,2:6]
wsj_df <- transpose(data_values)
wsj_df <- data.frame(year_vals, wsj_df)
wsj_df[wsj_df=="-"] <- NA
colnames(wsj_df) <- c("Year", data_labels)
wsj_df <- wsj_df[,colSums(is.na(wsj_df))<nrow(wsj_df)]
wsj_df <- wsj_df[rev(rownames(wsj_df)),]
rownames(wsj_df) <- NULL
print(wsj_df)
year <- wsj_df$Year
revenue <- as.numeric(gsub(",", "", wsj_df$`Sales/Revenue`))

plot_height <- signif(revenue/1000, digits = 3)
barplot(plot_height, names.arg = year, main = 'Amazon.com Sales/Revenue', xlab = 'Year', ylab = "Billion Dollars")
```
# Revenue Growth

```{r}
r <- length(year)
revenue_data <- data.frame(revenue)
rownames(revenue_data) <- year

revenue_data$growth <- NA
revenue_data$growth[2:r] <- diff(revenue_data$revenue)

revenue_data$growth_rate <-NA
revenue_data$growth_rate[2:r] <- revenue_data$growth[2:r] / revenue_data$revenue[1:r-1]

print(signif(revenue_data, digits = 3))

```

## Operating Expenses

In this section we calculate the net operating profit (NOP) and neta operating profit margin (NOPM).
The formula is:
$$NOP=Revenue-({CGS}+{SGA}+{R\&D})$$
and
$$NOPM=NOP/{OperatingRevenue}$$
Cost of Goods Sold (CGS), Selling, General and Administrative Expenses (SGA), Research and Development (RND). Operating revenue is revenue generated by the company's primary business operations.

```{r}
cgs <- c(123815, 143747, 208056, 238048, 246910)
sga <- c(52177, 64313, 87193, 116485, 138428)
rnd <- c(28837, 35931, 42740, 56052, 73213)
nop <- revenue -(cgs + sga + rnd)
nopm <- nop / revenue
nopm_data <- data.frame(revenue,cgs,sga,rnd,nop,nopm)
rownames(nopm_data) <- year
print(signif(nopm_data, digits = 3))

```
## Averages Growth and NOPM
```{r}
library("COINr")
periods <- 3
idx_range <- (length(year)-periods+1):length(year)
agr <- mean(revenue_data$growth_rate[idx_range])
cagr_range <- (length(year)-periods):length(year)

cagr <- CAGR(revenue[cagr_range],year[cagr_range])
anopm <- mean(nopm[idx_range])

print(paste(periods,"Year Average Growth Rate", signif(agr, digits = 3)))
print(paste(periods,"Year Compound Average Growth Rate", signif(cagr, digits = 3)))
print(paste(periods,"Year Average Net Operating Profit Margin", signif(anopm, digits = 3)))
```
So not let's look at the company's projected NOP given an excess return period (ERP) of 7 years

## Excess Return Period

```{r}
ERP <- 7
future_years  <- seq(year[length(year)] + 1, length.out = ERP)
future_revenue <- cumprod(c(revenue[5], rep((1+cagr), ERP)))
future_revenue <- future_revenue[2:length(future_revenue)]
future_nopm_data <- data.frame(future_revenue, (future_revenue * anopm))
colnames(future_nopm_data) <- c('revenue', 'nop')
rownames(future_nopm_data) <- future_years
print(signif(future_nopm_data, digits = 3))
```

## Taxes
Figure out an average tax rate fom historical data. Depreciation and Amortization are factored in later.
Ity seems in some cases there is negative adjustments so lelt's exclude that for tha average.

```{r}
income_before_tax <-c(11261, 13976, 24178, 38151, -5936)
income_taxes <- c(1197, 2374, 2863, 4791, -3217)
tax_rate <- income_taxes / income_before_tax
tax_table <- data.frame(income_before_tax, income_taxes, tax_rate)
row.names(tax_table) <- year
print(tax_table)
```
```{r}
unadjusted_tax_rate <- mean(tax_rate[2:4])
print(paste("Average Unadjusted Tax Rate: ", unadjusted_tax_rate ))
```

## NOPAT Table

```{r}
# for now ... unadjusted
tax_rate <- unadjusted_tax_rate
print(tax_rate)
nopat_table <- data.frame('nop' = future_nopm_data$nop, 'nopat' = future_nopm_data$nop * (1 - tax_rate))
rownames(nopat_table) <- future_years
print(nopat_table)
```

